# ランダムタイトル量産機能 実装ガイド

## 概要

お笑いモード専用の新機能として、**テーマ入力不要で AI が自動的にバカバカしいタイトルを 5-10 個生成する**システムを実装しました。

## 実装内容

### 1. お笑いフックパターン

以下の 5 つのパターンをランダムにブレンドしてタイトルを生成します：

#### 1. 属性反転

本来の立場を逆転させる

- 例: 客が店員に謝罪し続ける、銀行強盗が窓口で説教される

#### 2. 理不尽な数値化

どうでもいいことを極端な数値にする

- 例: 時速 300km の出前、999 階への配達、10 円で買われるプライド

#### 3. 語彙の誤解

ずんだもんが言葉を 100%間違えて覚える

- 例: スマートホームを「ずんだ餅の家」だと思う

#### 4. 物理的解決

精神的な問題を暴力や物理で解決する

- 例: AI に論破されたからコンセントを抜く

#### 5. コンプラの暴走

マナーやルールを意識しすぎて地獄になる

- 例: 謝罪の練習で逆ギレする、酒禁止の飲み会

### 2. 新規追加ファイル

#### バックエンド

**プロンプトファイル**:

- `backend/app/prompts/comedy/title_batch_generation.md`
  - お笑いフックパターンの詳細定義
  - タイトル生成ルール
  - 5-10 個のタイトル量産ロジック

**データモデル**:

```python
# backend/app/models/script_models.py

class ComedyTitleCandidate(BaseModel):
    """お笑いタイトル候補（量産用）"""
    id: int
    title: str
    hook_pattern: str  # 使用したフックパターン
    situation: str  # シチュエーション
    chaos_element: str  # カオス要素
    expected_conflict: str  # 予想される対立構造

class ComedyTitleBatch(BaseModel):
    """お笑いタイトル量産結果"""
    titles: List[ComedyTitleCandidate]  # 5-10個
```

**生成ロジック**:

```python
# backend/app/core/comedy_script_generator.py

def generate_title_batch(self, llm, progress_callback) -> ComedyTitleBatch:
    """ランダムにタイトルを5-10個量産"""
    # プロンプト読み込み
    # LLM呼び出し
    # パース
    return title_batch
```

**API エンドポイント**:

```python
# backend/app/api/scripts.py

@router.post("/comedy/titles/batch")
async def generate_comedy_titles_batch():
    """お笑いモード: ランダムタイトル量産（5-10個）"""
    # temperature 0.9 固定
    # テーマ入力不要
```

#### フロントエンド

**型定義**:

```typescript
// frontend/src/types/index.ts

export interface ComedyTitleCandidate {
  id: number;
  title: string;
  hook_pattern: string;
  situation: string;
  chaos_element: string;
  expected_conflict: string;
}

export interface ComedyTitleBatch {
  titles: ComedyTitleCandidate[];
}
```

**API クライアント**:

```typescript
// frontend/src/api/scripts.ts

generateComedyTitlesBatch: async (): Promise<ComedyTitleBatch> => {
  const response = await apiClient.post<ComedyTitleBatch>(
    "/scripts/comedy/titles/batch"
  );
  return response.data;
};
```

**UI コンポーネント**:

- `frontend/src/components/script/TitleCandidatesSection.tsx`
  - タイトル候補一覧表示
  - フックパターン別の色分け
  - 詳細情報表示（カオス要素、予想される対立）
  - 選択・再生成ボタン

**メインページ更新**:

- `frontend/src/pages/ScriptGenerationPage.tsx`
  - ランダム生成ボタン追加
  - タイトル候補選択フロー
  - 選択後の自動遷移

### 3. 使用フロー

#### パターン 1: ランダムタイトル生成（推奨）

1. **お笑いモード選択**
2. **「🎲 ランダムタイトルを 5-10 個生成」ボタンをクリック**
   - テーマ入力不要
   - AI が自動的に 5-10 個のバカバカしいタイトルを生成
3. **タイトル候補から選択**
   - 各候補にフックパターン、カオス要素、予想される対立が表示される
   - 気に入ったタイトルをクリック
4. **アウトライン生成へ**
   - 選択したタイトルで自動的にアウトライン生成に進む

#### パターン 2: テーマ入力（従来通り）

1. **お笑いモード選択**
2. **テーマを入力**（例: 猫、ラーメン）
3. **「テーマからタイトルを生成」ボタンをクリック**
4. **タイトル確認・承認**
5. **アウトライン生成へ**

## タイトル生成例

### 属性反転系

```
【逆転】客が店員に土下座して謝り続けた結果wwww
【衝撃】生徒が先生を叱責し続けたら職員室崩壊した
【カオス】ペットが飼い主を教育したら家庭崩壊した件
```

### 理不尽な数値化系

```
【検証】時速500kmで出前したら料理が消滅した
【実験】999階まで階段で荷物運んだら精神崩壊した
【悲報】10円でプライド売ったら人生終わった
```

### 語彙の誤解系

```
【誤解】リモートワークを遠隔操作だと思った結果【奴隷化】
【バカ】クラウドを雲の中で作業だと信じた男の末路
【無知】サブスクをサブい好きな人だと勘違いした結果
```

### 物理的解決系

```
【暴力】AIに論破されたからコンセント抜いた結果wwww
【破壊】ストレスを壁に叩きつけたら家が壊れた
【投棄】悩みをゴミ箱に捨てたら人生変わった
```

### コンプラの暴走系

```
【地獄】謝罪の練習したら逆ギレして大炎上した
【悲報】配慮しすぎて誰も喋れない会議になった
【崩壊】ハラスメント対策で会話禁止にした結果
```

## UI 設計

### InputSection（お笑いモード）

```
┌─────────────────────────────────────┐
│ 🎲 ランダムタイトルを5-10個生成      │  ← 新規追加
│    （テーマ不要）                    │
├─────────────────────────────────────┤
│ テーマからタイトルを生成             │  ← 従来通り
└─────────────────────────────────────┘
```

### TitleCandidatesSection

```
┌─────────────────────────────────────┐
│ ランダムタイトル候補        [再生成]  │
├─────────────────────────────────────┤
│ 気に入ったタイトルをクリック         │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 【属性反転】客が店員に土下座...  │ │
│ │ [属性反転] [コンビニ]            │ │
│ │ カオス要素: 客と店員の立場逆転   │ │
│ │ 予想: めたんが常識を叫ぶ         │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 【語彙誤解】スマートホームを...  │ │
│ │ [語彙の誤解] [自宅]              │ │
│ │ カオス要素: IoT機器が全部食べ物 │ │
│ │ 予想: めたんの説明を全部誤解     │ │
│ └─────────────────────────────────┘ │
│ ... (5-10個表示)                    │
└─────────────────────────────────────┘
```

## 技術的特徴

### 1. 完全ランダム生成

- ユーザーのテーマ入力不要
- AI が 5 つのフックパターンを自動的に組み合わせる
- 毎回異なる組み合わせで予測不可能

### 2. 高 Temperature 設定

- お笑いモードは `temperature=0.9` 固定
- 創造性とバカバカしさを最大化
- 予測不可能な展開を実現

### 3. メタ情報の充実

- 各タイトルに「フックパターン」を明示
- 「カオス要素」で面白さのポイントを説明
- 「予想される対立」でキャラクター動きを予測

### 4. 多段生成フロー

- タイトル選択 → アウトライン → 台本
- 選択したタイトルの情報を引き継ぐ
- シームレスな生成体験

## 設定とカスタマイズ

### プロンプト調整

`backend/app/prompts/comedy/title_batch_generation.md` を編集することで：

- フックパターンの追加・変更
- タイトル生成ルールの調整
- 出力数の変更（現在 5-10 個）

### Temperature 調整

`backend/app/api/scripts.py` の `generate_comedy_titles_batch` 関数で：

```python
temperature = 0.9  # この値を変更
```

### UI 表示のカスタマイズ

`frontend/src/components/script/TitleCandidatesSection.tsx` で：

- フックパターンの色分け
- 表示レイアウト
- 詳細情報の表示/非表示

## トラブルシューティング

### タイトルが 5 個未満しか生成されない

→ プロンプトの制約を確認
→ Temperature を上げる（0.9 → 1.0）

### タイトルが教育的すぎる

→ プロンプトの「絶対禁止」セクションを強化
→ NG ワードリストを追加

### 同じパターンばかり生成される

→ Temperature を上げる
→ プロンプトに「多様性」の指示を追加

## 今後の拡張案

### 1. フックパターンの追加

- 時間軸の歪み（過去と未来が混在）
- 規模の不一致（小さい問題を大げさに）
- メタ発言（台本を批判する）

### 2. タイトルのお気に入り機能

- 生成したタイトルを保存
- 後で再利用可能

### 3. タイトル編集機能

- 生成されたタイトルを微調整
- フックパターンを変更

### 4. タイトル履歴

- 過去に生成したタイトルを表示
- 再生成の参考にする

## まとめ

この機能により、お笑いモードは：

✅ **テーマ入力不要** - ボタン 1 つでタイトル量産
✅ **完全ランダム** - 毎回異なる組み合わせ
✅ **お笑い構造** - 5 つのフックパターンで面白さを保証
✅ **選択の楽しさ** - 5-10 個から好きなものを選ぶ
✅ **シームレス** - 選択後は自動的にアウトライン生成へ

「ガチャを引く楽しさ」と「自分で選ぶ楽しさ」を両立した、新しい台本生成体験を実現しました！
